# **2020 OS Project 1** — Process Scheduling



### 1. 設計

#### 1-1. code

#### 1-1-1. main.c

main.c負責處理輸入，將process依照ready_time排序後，全由scheduler.c負責。

#### 1-1-2. process.c

負責建立新process、提高process的priority和降低process的priority。其中有關調整priority的部分，會呼叫CPU.c將process放在正確的CPU上。

#### 1-1-3. CPU.c

負責將由process.c調整priority的process放置在特定的CPU上，以及計時(unit_time)。

#### 1-1-4. scheduler.c

負責將main.c處理好的輸入做排程。每一秒會根據時間和排程狀態做出相對應的動作，如呼叫process.c調整process的priority和建立新的process。

#### 1-2. 流程

首先由main.c負責處理資料，將process依照ready_time排序後交由scheduler.c負責。scheduler.c每一秒皆會執行以下任務:

1. 若現在時間已到某process的ready time，則呼叫process.c建立該process

	1-1. fork後會將剛建立的process的priority調低並移至正確的CPU，該process直到被scheduler.c調高priority才會透過my_get_time得到start_time並進入迴圈。迴圈跑完後會透過my_get_time得到end_time並透過my_printk輸出相關訊息至dmesg
	
2. 依照policy決定接下來該執行的process

   2-1. 若有process正在執行，且policy為FIFO或SJF，則接下來執行正在執行的process

   2-2. 若沒有process正在執行，且policy為FIFO，則判斷是否可以執行最後執行的process的下一個process，可以則接下來執行該process，不行則接下來不執行任何process

   2-3. 若policy為PSJF，或沒有process正在執行且policy為FIFO，則判斷可執行且執行時間最短的process，若沒有則接下來不執行任何process

   2-4. 若policy為RR，且沒有process正在執行或正在執行的process已經執行500個unit time，則從最後執行的process的下一個process開始判斷是否可以執行，若可以則接下來執行該process，若不行則繼續尋找可執行的process。若全都無法執行則接下來不執行任何process

   2-5. 若policy為RR，且有process正在執行而且該process尚未執行500個unit time，則接下來執行正在執行的process

3. 若需要交換執行的process，則先呼叫process.c降低原process的priority，再呼叫process.c提高原process的priority，調整priority時會呼叫CPU.c將process放至正確的CPU

4. 若有執行process，將process的執行時間+1

5. 若process執行完畢，則輸出相關訊息至standard output

6. 將現在時間+1

直到所有process皆執行完畢就結束了

### 2. 核心版本

linux 4.14.25

### 3. 比較結果

下表為理論執行時間與實際執行時間的比較表。先依據TIME_MEASUREMENT算出平均的unit time，再依據dmesg.txt中的start time和end time算出exec_time，最後再利用這兩項算出exec_time的時間相當於幾個平均unit time，利用這個值與理論上的執行unit time做比較。

誤差最大的慢了**113.85**個unit time，大約是**0.20**秒，實際的時間是15113.85個unit time，比理論時間的15000個unit time慢了**0.76%**；誤差最小的快了**596.46**個unit time，大約是**1.05**秒，實際的時間是24403.54個unit time，比理論時間的25000個unit time快了2.39%。誤差百分比最大的慢了**6.82%**，實際的時間是534.12個unit time，比理論時間的500個unit time多了大概**34.12**個unit time，大約是**0.06**秒；誤差百分比最小的快了**8.98%**，實際的時間是3640.76個unit time，比理論時間的4000個unit time少了大概**359.24**個unit time，大約是**0.63**秒。單筆誤差都沒有超過**10%**，也都沒有超過**1000**個unit time。

造成這段誤差的主因是每個unit time的長度本來就不固定，利用平均的unit time來計算本來就會有誤差。其次，每顆CPU本來就都有其他系統process，所以會影響到實際結果。再者，調整priority也需要時間。最後，透過my_get_time向系統取得系統時間也要時間。綜合以上因素，這些誤差是不可避免的。

不過，整體而言，平均誤差沒有超過**2%**，也沒有超過**100**個unit time，理論跟實際上的差別其實沒有很明顯。



**unit time = 0.001764**
**average theoretical times = 5560.892857**
**average error times = -62.490816**
**average abs error times = 80.676262**
**average error percentange = -1.1238%**
**average absolute error percentage = 1.4508%**

|file|process name|theoretical time|execution time|error|error percentage|
|:---:|:---:|:---:|:---:|:---:|:---:|
|FIFO_1.txt||||||
||P1|500|504.98|4.98|1.00%|
||P2|500|484.11|-15.89|-3.18%|
||P3|500|494.38|-5.62|-1.12%|
||P4|500|493.97|-6.03|-1.21%|
||P5|500|483.30|-16.70|-3.34%|
|FIFO_2.txt||||||
||P1|80000|80016.93|16.93|0.02%|
||P2|5000|4896.90|-103.10|-2.06%|
||P3|1000|1006.74|6.74|0.67%|
||P4|1000|983.05|-16.95|-1.69%|
|FIFO_3.txt||||||
||P1|8000|7813.67|-186.33|-2.33%|
||P2|5000|5044.50|44.50|0.89%|
||P3|3000|2976.02|-23.98|-0.80%|
||P4|1000|1006.52|6.52|0.65%|
||P5|1000|1010.54|10.54|1.05%|
||P6|1000|998.50|-1.50|-0.15%|
||P7|4000|4037.31|37.31|0.93%|
|FIFO_4.txt||||||
||P1|2000|2026.85|26.85|1.34%|
||P2|500|507.96|7.96|1.59%|
||P3|200|205.72|5.72|2.86%|
||P4|500|507.90|7.90|1.58%|
|FIFO_5.txt||||||
||P1|8000|8010.36|10.36|0.13%|
||P2|5000|5031.04|31.04|0.62%|
||P3|3000|2990.30|-9.70|-0.32%|
||P4|1000|1005.80|5.80|0.58%|
||P5|1000|999.15|-0.85|-0.09%|
||P6|1000|1006.65|6.65|0.66%|
||P7|4000|4056.52|56.52|1.41%|
|PSJF_1.txt||||||
||P4|3000|3049.39|49.39|1.65%|
||P3|8000|8102.18|102.18|1.28%|
||**P2**|**15000**|**15113.85**|**113.85**|**0.76%**|
||P1|25000|25027.07|27.07|0.11%|
|PSJF_2.txt||||||
||P2|1000|1032.03|32.03|3.20%|
||P1|4000|4015.98|15.98|0.40%|
||P4|2000|2044.61|44.61|2.23%|
||P5|1000|978.27|-21.73|-2.17%|
||P3|7000|6927.70|-72.30|-1.03%|
|PSJF_3.txt||||||
||**P2**|**500**|**534.12**|**34.12**|**6.82%**|
||P3|500|518.32|18.32|3.66%|
||P4|500|508.27|8.27|1.65%|
||P1|3500|3610.36|110.36|3.15%|
|PSJF_4.txt||||||
||P3|1000|1002.31|2.31|0.23%|
||P2|3000|2984.45|-15.55|-0.52%|
||P4|4000|4042.77|42.77|1.07%|
||P1|7000|7060.02|60.02|0.86%|
|PSJF_5.txt||||||
||P1|100|92.08|-7.92|-7.92%|
||P3|200|192.82|-7.18|-3.59%|
||**P2**|**4000**|**3640.76**|**-359.24**|**-8.98%**|
||P4|4000|3878.05|-121.95|-3.05%|
||P5|7000|6751.75|-248.25|-3.55%|
|RR_1.txt||||||
||P1|500|501.94|1.94|0.39%|
||P2|500|488.70|-11.30|-2.26%|
||P3|500|500.69|0.69|0.14%|
||P4|500|498.99|-1.01|-0.20%|
||P5|500|497.23|-2.77|-0.55%|
|RR_2.txt||||||
||P1|7500|7318.99|-181.01|-2.41%|
||P2|8500|8384.84|-115.16|-1.35%|
|RR_3.txt||||||
||P3|14000|13617.03|-382.97|-2.74%|
||P1|18000|17561.47|-438.53|-2.44%|
||P2|17500|17154.18|-345.82|-1.98%|
||P6|20000|19604.90|-395.10|-1.98%|
||P5|23000|22575.24|-424.76|-1.85%|
||**P4**|**25000**|**24403.54**|**-596.46**|**-2.39%**|
|RR_4.txt||||||
||P4|4000|3974.94|-25.06|-0.63%|
||P5|4000|3973.67|-26.33|-0.66%|
||P6|4000|3971.59|-28.41|-0.71%|
||P3|13500|13388.59|-111.41|-0.83%|
||P7|15000|14946.31|-53.69|-0.36%|
||P2|19500|19369.76|-130.24|-0.67%|
||P1|23000|22863.68|-136.32|-0.59%|
|RR_5.txt||||||
||P4|4000|3980.02|-19.98|-0.50%|
||P5|4000|3975.99|-24.01|-0.60%|
||P6|4000|3932.33|-67.67|-1.69%|
||P3|13500|13182.32|-317.68|-2.35%|
||P7|15000|14767.57|-232.43|-1.55%|
||P2|19500|19106.10|-393.90|-2.02%|
||P1|23000|22546.87|-453.13|-1.97%|
|SJF_1.txt||||||
||P2|2000|2012.03|12.03|0.60%|
||P3|1000|981.57|-18.43|-1.84%|
||P4|4000|3847.09|-152.91|-3.82%|
||P1|7000|6747.37|-252.63|-3.61%|
|SJF_2.txt||||||
||P1|100|96.73|-3.27|-3.27%|
||P3|200|192.69|-7.31|-3.65%|
||P2|4000|3874.82|-125.18|-3.13%|
||P4|4000|3892.57|-107.43|-2.69%|
||P5|7000|6810.82|-189.18|-2.70%|
|SJF_3.txt||||||
||P1|3000|2936.24|-63.76|-2.13%|
||**P4**|**10**|**10.10**|**0.10**|**0.96%**|
||**P5**|**10**|**9.87**|**-0.13**|**-1.27%**|
||P6|4000|3893.98|-106.02|-2.65%|
||P7|4000|3878.61|-121.39|-3.03%|
||P2|5000|4897.16|-102.84|-2.06%|
||P3|7000|6818.23|-181.77|-2.60%|
||P8|9000|8835.78|-164.22|-1.82%|
|SJF_4.txt||||||
||P1|3000|2975.96|-24.04|-0.80%|
||P2|1000|962.32|-37.68|-3.77%|
||P3|4000|3947.59|-52.41|-1.31%|
||P5|1000|980.97|-19.03|-1.90%|
||P4|2000|1961.38|-38.62|-1.93%|
|SJF_5.txt||||||
||P1|2000|1966.54|-33.46|-1.67%|
||P2|500|483.38|-16.62|-3.32%|
||P3|500|511.94|11.94|2.39%|
||P4|500|501.01|1.01|0.20%|
|TIME_MEASUREMENT.txt||||||
||P0|500|491.24|-8.76|-1.75%|
||P1|500|494.10|-5.90|-1.18%|
||P2|500|489.21|-10.79|-2.16%|
||P3|500|490.83|-9.17|-1.83%|
||P4|500|497.70|-2.30|-0.46%|
||P5|500|494.23|-5.77|-1.15%|
||P6|500|501.10|1.10|0.22%|
||P7|500|515.46|15.46|3.09%|
||P8|500|526.50|26.50|5.30%|
||P9|500|499.64|-0.36|-0.07%|